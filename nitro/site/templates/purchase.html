<!DOCTYPE html>
<html lang="en">
<meta http-equiv="content-type" content="text/html;charset=UTF-8" />

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>LuxuryNitro - Purchase</title>
    <link rel="stylesheet" href="assets/vendors/core/core.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/fonts/feather-font/css/iconfont.css">
    <link rel="stylesheet" href="assets/vendors/datatables.net-bs4/dataTables.bootstrap4.css">
    <link rel="stylesheet" href="assets/vendors/toastr/toastr.min.css">
    <link rel="icon" href="assets/img/logo.png" type="image/png" />
</head>

<body>

    <div class="main-wrapper">

        <nav class="sidebar">
            <div class="sidebar-header">
                <a href="/" class="sidebar-brand">
                    Luxury<span>Nitro</span>
                </a>
                <div class="sidebar-toggler not-active">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            <div class="sidebar-body">
                <ul class="nav" style="padding-top: 10px">
                    <li class="nav-item">
                        <a href="/" class="nav-link">
                            <i class="link-icon" data-feather="layout"></i>
                            <span class="link-title">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item active">
                        <a href="purchase" class="nav-link">
                            <i class="link-icon" data-feather="dollar-sign"></i>
                            <span class="link-title">Purchase</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="faq" class="nav-link">
                            <i class="link-icon" data-feather="help-circle"></i>
                            <span class="link-title">FAQ</span>
                        </a>
                    </li>
                    
                    <li class="nav-item nav-category mb-3">
                        Tickets
                        <p class="text-muted" style="font-size: 10px;">Updates every 5s</p>
                    </li>
                    <li class="nav-item">
                        <a href="ticket-create" class="nav-link">
                            <i class="link-icon" data-feather="plus-circle"></i>
                            <span class="link-title">Create</span>
                        </a>
                    </li>
                    <li class="nav-item" id="loading-tickets">
                        <a class="nav-link">
                            <i class="link-icon" data-feather="loader"></i>
                            <span class="link-title">Loading...</span>
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="collapse" href="#closed-dropdown" role="button" aria-expanded="false" aria-controls="emails">
                            <i class="link-icon" data-feather="archive"></i>
                            <span class="link-title" id="closed-span">Closed</span>
                            <i class="link-arrow" data-feather="chevron-down"></i>
                        </a>
                        <div class="collapse" id="closed-dropdown">
                            <ul class="nav sub-menu" id="closed-items">
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="page-wrapper">
            <nav class="navbar">
                <a href="#" class="sidebar-toggler">
                    <i data-feather="menu"></i>
                </a>
                <div class="navbar-content">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a href="settings" title="Settings">
                                <i class="link-arrow text-secondary" style="width: 20px;" data-feather="settings"></i>
                            </a> 
                        </li>
                        <li class="nav-item">
                            <a href="logout" title="Logout">
                                <i class="link-arrow text-danger" style="width: 20px;" data-feather="log-out"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            <div class="page-content">
                <div class="d-flex justify-content-between align-items-center flex-wrap grid-margin">
                    <div class="mt-5">
                        <h4 class="mb-3 mb-md-0">Purchase</h4>
                    </div>
                </div>
                <div class="row d-flex justify-content-center mb-4"> <!-- <div class="row d-md-block"> -->
                    <div class="col-sm-12 col-lg-3 grid-margin text-center">
                        <div class="card">
                            <div class="card-header align-middle">
                                <i class="mb-1 text-primary mr-2 icon-small" data-feather="dollar-sign"></i>
                                Buy Credits
                            </div>
                            <div class="card-body" style="padding-bottom: 0.9rem; padding-top: 1rem">
                                <div class="text-center" style="margin-top: -6px; margin-bottom: 5px;">
                                    <span>You have <span id="credits-amount">...</span> credits.</span>
                                </div>
                                <div class="row">
                                    <img alt="Bitcoin" title="Bitcoin" src="https://cdn.sellix.io/static/gateways/new/bitcoin.svg" class="mx-auto d-block img-fluid text-center align-middle">
                                    <img alt="Litecoin" title="Litecoin" src="https://cdn.sellix.io/static/gateways/new/litecoin.svg" class="mx-auto d-block img-fluid text-center align-middle">
                                    <img alt="CashApp" title="CashApp" src="https://cdn.sellix.io/static/gateways/new/cashapp.svg" class="mx-auto d-block img-fluid text-center align-middle">
                                    <img alt="PayPal" title="PayPal" src="https://cdn.sellix.io/static/gateways/new/paypal.svg" class="mx-auto d-block img-fluid text-center align-middle">
                                    <img alt="Stripe (Bank Cards)" title="Stripe (Bank Cards)" src="https://cdn.sellix.io/static/gateways/new/stripe.svg" class="mx-auto d-block img-fluid text-center align-middle">
                                    <img alt="Ethereum" title="Ethereum" src="https://cdn.sellix.io/static/gateways/new/ethereum.svg" class="mx-auto d-block img-fluid text-center align-middle">
                                    <img alt="Solana" title="Solana" src="https://cdn.sellix.io/static/gateways/new/solana.svg" class="mx-auto d-block img-fluid text-center align-middle">
                                </div>
                                <div class="row align-middle mt-1 mx-auto justify-content-center">
                                    <div style="margin-top: 7px;">
                                        <i class="text-muted icon-small d-block align-middle mr-1" style="height: 20px; width: 20px;" data-feather="check-circle"></i>
                                    </div>
                                    <div>
                                        <span class="align-middle text-muted" style="margin-top: 1px; font-size: 10px;">Credits will be redeemed to this account</span>
                                        <br style='display: block; content: ""; margin-top: -8px;'>
                                        <span class="align-middle text-muted" style="margin-top: 1px; font-size: 10px;">after payment has been confirmed.</span>
                                    </div>
                                </div>
                                <a class="btn btn-primary mt-1 mb-0" style="width: 28%;" data-sellix-product="641b388e1bf43" data-sellix-custom-username="{{ username }}">Crypto</a>
                                <a class="btn btn-primary mt-1 mb-0" style="width: 38%;" data-sellix-product="64c98b347fce7" data-sellix-custom-username="{{ username }}">PayPal/Card</a>
                                <a class="btn btn-primary mt-1 mb-0" style="width: 28%;" href="ticket-create">Other</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12 col-lg-3 grid-margin">
                        <div class="card">
                            <div class="card-header align-middle text-center">
                                <i class="mb-1 text-primary mr-2 icon-small" data-feather="shopping-cart"></i>
                                Spend Credits
                            </div>
                            <div class="card-body" style="padding-bottom: 0.9rem;padding-top: 0.75rem;">
                                <div class="row align-middle">
                                    <label class="text-muted mb-0">Discord Token</label>
                                    <i class="text-secondary icon-small d-block align-middle ml-1" data-toggle="tooltip" data-placement="top" title="To obtain your token, use the QR code to the right/below." style="height: 15px; width: 15px; margin-top: 2px; margin-left: 5px;" data-feather="help-circle"></i>
                                    
                                </div>
                                <div class="row align-middle" style="margin-bottom: 2px">
                                    <i class="text-success icon-small d-block align-middle mr-1" style="height: 15px; width: 15px; margin-top: 2px" data-feather="shield"></i>
                                    <span class="align-middle" style="color: #57637a">Your Token is safe. <a style="color: #2169b9" target="_blank" href="faq#faqOne">Learn more</a></span>
                                </div>
                                <div class="row mb-1">
                                    <input type="text" class="w-100 align-middle form-control form-control-sm" id="token" placeholder="MTA1NjcwNTkzMzI4....">
                                </div>
                                <div class="row">
                                    <label class="text-muted" style="margin-bottom: 2px">Quantity</label>
                                    <label class="text-muted" style="margin-bottom: 2px; margin-left: 15%;">Anonymous?</label>
                                    <i class="text-secondary icon-small d-block align-middle ml-1" data-toggle="tooltip" data-placement="top" title="Anonymous will hide the username you signed up with when in the queue." style="height: 15px; width: 15px; margin-top: 2px; margin-left: 5px;" data-feather="help-circle"></i>
                                </div>
                                <div class="row">
                                    <input type="number" id="quantity" style="width: 25%" class="align-middle form-control form-control-sm" value="1">
                                    <div class="form-check" style="margin-left: 5%; height: 100%; margin-top: 6px; margin-bottom: 0;">
                                        <label class="form-check-label" onclick="anonymousToggle()">
                                            <input style="accent-color: #764ef2;" id="anonymous" type="checkbox" class="align-middle form-control form-control-sm form-check-input text-center">
                                        </label>
                                    </div>
                                    <div class="flex-fill">
                                        <a onclick="purchase()" id="action-btn" class="btn btn-primary align-middle float-right">Add to Queue</a>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12 col-lg-3 grid-margin">
                        <div class="card">
                            <div class="card-header align-middle text-center">
                                <i class="mb-1 text-primary mr-2 icon-small" data-feather="key"></i>
                                Discord Token via QR Code
                            </div>
                            <div class="card-body" style="padding-bottom: 0.9rem; padding-top: 1rem">
                                <div class="row" style="height: 129px">
                                    <div id='loading-div' class="col-5 pl-0">
                                        <div class="row align-items-center h-100 w-100 text-center">
                                            <div class="col-12">
                                                <span class="text-muted">Loading...</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div id='qr-code-div' class="col-5 pl-0" style="display: none;">
                                        <img id='qr-code' style="border-radius: 6%; height: 133px;">
                                        <img src="https://i.imgur.com/YNqdVWf.png" style="position: absolute; height: 40px; top: 47px; left: 47px;">
                                    </div>
                                    <div id='avatar-div' class="col-5 pl-0 text-center" style="display: none;">
                                        <svg width="60" height="60" viewBox="0 0 60 60">
                                            <foreignObject x="0" y="0" width="60" height="60">
                                                <img id='avatar-image' class="rounded-circle" height="60px" src="https://cdn.discordapp.com/avatars/1056705933289468006/25fec3f3fe8238bd8d1d4e5659be0d6f.webp?size=128">
                                            </foreignObject>
                                            <foreignObject x="44" y="36" width="16" height="24">
                                                <img height="24px" width="16px" id='mobile-icon' src="assets/img/mobile.png">
                                            </foreignObject>
                                        </svg>
                                        <br style='display: block; content: ""; margin-top: 5px;'>
                                        <span id="phone-prompt">Check your phone!</span>
                                        <br style='display: block; content: ""; margin-top: 2px;'>
                                        <div style="line-height: 1.1em">
                                            <span class="text-muted" style="font-size: 12px">Logg<span id="logging-in">ing</span> in as <span id="discord-tag">chasa#0001</span></span>
                                        </div>
                                        
                                    </div>
                                    <div class="col-7 px-0 text-center" id="scan-info">
                                        <br style='display: block; content: ""; margin-top: 15px;'>
                                        <span>Scan the QR code in the Discord
                                        <br style='display: block; content: ""; margin-top: 0px;'>
                                        App on your Phone.
                                        <br style='display: block; content: ""; margin-top: 5px;'>
                                        It will be entered into the input field for you.</span>
                                    </div>
                                    <div class="col-12" id="captcha-div" style="display: none;">
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row d-md-block">
                    <div class="col-sm-12 col-lg-12 grid-margin">
                        <div class="card">
                            <div class="card-header align-middle">
                                <i class="mb-1 text-primary mr-2 icon-small" data-feather="clipboard"></i>
                                Credit History
                            </div>
                            <div class="card-body">
                                <div class="table-responsive" style="margin-top: -9px">
                                    <table id="data-table" class="table">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Time</th>
                                                <th>Credits</th>
                                                <th>Closing Balance</th>
                                                <th>Reason</th>
                                            </tr>
                                        </thead>
                                        <tbody id="credit-history">
                                        </tbody>
                                    </table>
                                    <p id="credit-history-info" class="text-muted text-center mt-2">Loading...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <footer class="footer d-flex flex-column flex-md-row align-items-center justify-content-between">
                <p class="text-muted text-center text-md-left">Copyright © 2023 <a href="/">LuxuryNitro</a>. All rights reserved.</p>
                <p class="text-muted text-center text-md-right">Made with ❤️ by <a href="https://chasa.wtf" target="_blank" class="text-primary">chasa</a></p>
            </footer>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanilla-hcaptcha"></script>
    <script src="assets/vendors/core/core.js"></script>
    <script src="assets/vendors/feather-icons/feather.min.js"></script>
    <script src="assets/js/templatef195.js?v=2.1"></script>
    <script src="assets/vendors/toastr/toastr.min.js"></script>
    <script src="https://cdn.sellix.io/static/js/embed.js"></script>
    <script>
        window.anonymous = false
        function anonymousToggle(){
            if (window.anonymous == true){
                window.anonymous = false
            } else {
                window.anonymous = true
            }
        }
        
        function formatTime(unixSeconds) {
            if (!unixSeconds) {
                return "";
            }
            
            var date = new Date(unixSeconds * 1000);

            var day = ("0" + date.getDate()).slice(-2);
            var month = date.toLocaleString("default", { month: "short" });
            var year = date.getFullYear();
            var hour = ("0" + date.getHours()).slice(-2);
            var minute = ("0" + date.getMinutes()).slice(-2);
            var second = ("0" + date.getSeconds()).slice(-2);

            var formattedDate =
                day + " " + month + " " + year + " " + hour + ":" + minute + ":" + second;

            return formattedDate;
        }

        function purchase() {
            $('#action-btn').attr("disabled", true)
            axios({
                method: 'post',
                url: '/api/v1/users/@me/orders',
                withCredentials: true,
                data: {
                    'quantity': $('#quantity').val(),
                    'token': $('#token').val(),
                    'anonymous': window.anonymous
                }
            })
            .then(function (response) {
                $('#action-btn').attr("disabled", false)
                toastr["success"](response.data.message, "Success");
            })
            .catch(function (error) {
                console.log(error);
                if (error.response.status == 401) {
                    window.location.reload();
                }
                toastr["error"](error.response.data.message, "Error");
                $('#action-btn').attr("disabled", false)
            });
        }


        function fetch_tickets() {
            axios({
                method: 'get',
                url: '/api/v1/users/@me/tickets',
                withCredentials: true
            })
            .then(function (response) {
                console.log(response);
                var closed_unread = false
                for(let ticket of response.data) {
                    if (ticket.seen == false && ticket.open == false) {
                        closed_unread = true
                    }
                    if (ticket.seen == true) {
                        var name_tag = `#${ticket.id}`
                    } else {
                        var name_tag = `<b>#${ticket.id}</b><span style="margin-left: 3px;">(Unread)</span>`
                    }
                    
                    if ($(`#ticket-${ticket.id}`).length) {
                        if (ticket.open == true) {
                            $(`#ticket-${ticket.id}`).html(`
                            <a href="ticket?id=${ticket.id}" class="nav-link">
                                <i class="link-icon" data-feather="message-square"></i>
                                <span class="link-title">${name_tag}</span>
                            </a>`);
                        } else {
                            $(`#ticket-${ticket.id}`).html(`<a href="ticket?id=${ticket.id}" class="nav-link">${name_tag}</a>`);
                        }
                    } else {
                        if (ticket.open == true) {
                            $('#loading-tickets').after(`
                            <li class="nav-item" id="ticket-${ticket.id}">
                                <a href="ticket?id=${ticket.id}" class="nav-link">
                                    <i class="link-icon" data-feather="message-square"></i>
                                    <span class="link-title">${name_tag}</span>
                                </a>
                            </li>`)
                        } else {
                            $('#closed-items').append(`
                            <li class="nav-item" id="ticket-${ticket.id}">
                                <a href="ticket?id=${ticket.id}" class="nav-link">${name_tag}</a>
                            </li>`)
                        }
                    }
                }
                
                if (closed_unread == true) {
                    $('#closed-span').html('<b>Closed</b> (Unread)')
                } else {
                    $('#closed-span').html('Closed')
                }
                feather.replace()
                $('#loading-tickets').hide()
            })
            .catch(function (error) {
                console.log(error);
                if (error.response.status == 401) {
                    window.location.reload();
                }
            });
        }

        axios({
            method: 'get',
            url: '/api/v1/users/@me/credits',
            withCredentials: true
        })
        .then(function (response) {
            console.log(response);
            $('#credits-amount').html(response.data.total)
            credits_html = ''
            for(let credit of response.data.history) {
                if (credit.change > 0) { text_class = 'text-success' }
                else { text_class = 'text-danger'}
                
                credits_html += `<tr>
                    <th>#${credit.id}</th>
                    <th>${formatTime(credit.time)}</th>
                    <th class="${text_class}">${credit.change}</th>
                    <th>${credit.closing_balance} Credits</th>
                    <th>${credit.reason}</th>
                </tr>`
            }
            
            $('#credit-history').html(credits_html)
            
            if (credits_html !== '') {
                $('#credit-history-info').hide()
            } else {
                $('#credit-history-info').html('No history found.').show()
            }
        })
        .catch(function (error) {
            console.log(error);
            if (error.response.status == 401) {
                window.location.reload();
            }
        });
        fetch_tickets()
        setInterval(fetch_tickets, 5000)
        
        function ws_connect() {
            window.ws = new WebSocket(`${(location.protocol === 'https:') ? 'wss' : 'ws'}://${window.location.host}/api/v1/qr_code`);
    
            window.kill_ws = false

            window.last_message_date = ''
            
            window.ws.onmessage = function (evt) { 
                var received_data = JSON.parse(evt.data);
                if (received_data.op == 'close') {
                    $('#phone-prompt').html(received_data.reason)
                    ws.close()
                } else if (received_data.op == 'qrcode') {
                    $('#qr-code').attr('src', received_data.d)
                    $('#loading-div').hide()
                    $('#avatar-div').hide()
                    $('#qr-code-div').show()
                    $('#scan-info').show()
                } else if (received_data.op == 'data') {
                    $('#avatar-image').attr('src', `https://cdn.discordapp.com/avatars/${received_data.d.id}/${received_data.d.avatar}.webp?size=128`)
                    if (received_data.d.discrim == "0") {
                        $('#discord-tag').html(`@${received_data.d.user}`)
                    } else {
                        $('#discord-tag').html(`${received_data.d.user}#${received_data.d.discrim}`)
                    }
                    $('#phone-prompt').html('Check your phone!')
                    $('#qr-code-div').hide()
                    $('#avatar-div').show()
                    $('#scan-info').show()
                } else if (received_data.op == 'token') {
                    $('#token').val(received_data.d)
                    $('#logging-in').html('ed')
                    $('#phone-prompt').html('Logged in!')
                    $('#mobile-icon').attr('src', `assets/img/done.png`)
                    $('#captcha-div').hide()
                    $('#avatar-div').show()
                    $('#scan-info').show()
                    window.kill_ws = true
                    ws.close()
                } else if (received_data.op == 'ticket') {
                    axios({
                        method: 'post',
                        url: 'https://discord.com/api/v9/users/@me/remote-auth/login',
                        data: {
                            ticket: received_data.d
                        }
                    }).then(function (response) {
                        console.log(response);
                        ws.send(JSON.stringify({'op': 'token', 'd': response.data.encrypted_token}))
                        
                    }).catch(function (error) {
                        console.log(error);
                        response = error.response
                        $('#captcha-div').html(`<h-captcha id="signupCaptcha"
                            site-key="${response.data.captcha_sitekey}"
                            theme="dark"
                            size="normal"
                            rqdata="${response.data.captcha_rqdata}"
                            tabindex="0">
                        </h-captcha><br>
                        <span>Discord added captchas to remote auth, so please complete this.</span>`)
                        $('#captcha-div').show()
                        $('#avatar-div').hide()
                        $('#scan-info').hide()
                        window.rq_token = response.data.captcha_rqtoken
                        
                        document.getElementById('signupCaptcha').addEventListener('verified', (e) => {
                            axios({
                                method: 'post',
                                url: 'https://discord.com/api/v9/users/@me/remote-auth/login',
                                data: {
                                    ticket: received_data.d,
                                    captcha_key: e.token,
                                    captcha_rqtoken: window.rq_token
                                }
                            }).then(function (response) {
                                ws.send(JSON.stringify({'op': 'token', 'd': response.data.encrypted_token}))
                            }).catch(function (error) {
                                console.log(error);
                            });
                        });
                    });
                }
            }
            window.ws.onclose = function() { 
                setTimeout(function() {
                    if (window.kill_ws != true) {
                        ws_connect()
                    }
                }, 500);
            };
            
            
        }
        
        function ws_ping() {
            if (!window.ws) {
                return
            }
            if (window.ws.readyState !== 1) {
                return
            }
            window.ws.send(JSON.stringify({'op': 'ping'}))
        }
        
        ws_connect()
        var ws_ping_interval = setInterval(ws_ping,2500);

    </script>
</body>

</html>